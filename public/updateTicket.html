<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>FlawNalysis</title>
        <link rel="icon" href="img/logoOnly.png" type="image/x-icon" />

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
        <link rel="stylesheet" href="ticketForm.css">
    </head>
<body>
    <div class="container">
        <div class="row">
          <div class="col-lg-7 mx-auto">
            <div class="card my-auto mx-auto p-4 bg-info" id ="vertical-center">
              <div class="card-body bg-info">
                <div class="container bg-info">
                  <form id="contact-form" role="form" onsubmit="submitUpdate(); return false;">
                    <div class="controls bg-info">
                      <h3 class = "text-center pb-3 mx-5" style="color:white;">Click on Blue Pencil Icon to edit a field. First and Last name cannot be editted</h3>
                      <div class="row">
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="form_name">Firstname *</label>
                            <input
                              id="form_name"
                              type="text"
                              name="name"
                              class="form-control"
                              placeholder="John"
                              required="required"
                              data-error="Firstname is required."
                              disabled
                            />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="form_lastname">Lastname *</label>
                            <input
                              id="form_lastname"
                              type="text"
                              name="surname"
                              class="form-control"
                              placeholder="Smith"
                              required="required"
                              data-error="Lastname is required."
                              disabled
                            />
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="form_email">Email *</label>
                            <!--<button class = "remove" type = "button" onclick="disableEnable(email)"><i class="glyphicon glyphicon-pencil"></i></button>-->
                            <input
                              id="form_email"
                              type="email"
                              name="email"
                              class="form-control"
                              placeholder="johnsmith@exapmle.com"
                              required="required"
                              data-error="Valid email is required."
                              readonly="true"
                              ondblclick="this.readOnly='';"
                            />
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="form_need"
                              >Please specify your need *</label
                            >
                            <!--<button class = "remove" type = "button" onclick="disableEnable(selection)"><i class="glyphicon glyphicon-pencil"></i></button>-->
                            <select
                              id="form_need"
                              name="need"
                              class="form-control"
                              required="required"
                              data-error="Please specify your need." 
                              readonly="true"
                              ondblclick="this.readOnly='';">
                              <option value="" selected disabled>
                                --Select Your Issue--
                              </option>
                              <option>Email</option>
                              <option>Phone</option>
                              <option>Computer</option>
                              <option>Other</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-6">
                          <div class="form-group">
                            <label for="form_assigned">Assigned To</label>
                            <!--<button class = "remove" type = "button" onclick="disableEnable(assignedTO)"><i class="glyphicon glyphicon-pencil"></i></button>-->
                            <input
                              id="form_assigned"
                              type="name"
                              name="name"
                              class="form-control"
                              placeholder="Josh Wagner"
                              readonly="true"
                              ondblclick="this.readOnly='';"
                            />
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="form-group">
                            <label for="form_need"
                              >Status *</label
                            >
                            <!--<button class = "remove" type = "button" onclick="disableEnable(status)"><i class="glyphicon glyphicon-pencil"></i></button>-->
                            <select
                              id="form_status"
                              name="need"
                              class="form-control"
                              required="required"
                              data-error="Please specify your need." 
                              readonly="true"
                              ondblclick="this.readOnly='';">
                              <option value="" selected disabled>
                                --Select Status--
                              </option>
                              <option>Pending</option>
                              <opt</option>
                              <option>In Progress</option>
                              <option>Progress</option>
                            </select>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="form-group">
                            <label for="form_need" 
                              >Priority*</label
                            >
                            <!--<button class = "remove" type = "button" onclick="disableEnable(priority)"><i class="glyphicon glyphicon-pencil"></i></button>-->
                            <select
                              id="form_priority"
                              name="need"
                              class="form-control"
                              required="required"
                              data-error="Please specify your need." 
                              readonly="true"
                              ondblclick="this.readOnly='';">
                              <option value="" selected disabled>
                                --Select Priority--
                              </option>
                              <option>High</option>
                              <opt</option>
                              <option>Normal</option>
                              <option>Low</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-md-12">
                          <div class="form-group">
                            <label for="form_message">Ticket Details *</label>
                            <!--<button class = "remove" type = "button" onclick="disableEnable(textArea)"><i class="glyphicon glyphicon-pencil"></i></button>-->
                            <textarea
                              id="form_message"
                              name="message"
                              class="form-control"
                              placeholder="Write your message here."
                              rows="4"
                              required="required"
                              data-error="Please, leave us a message."
                              readonly="true"
                              ondblclick="this.readOnly='';"
                            ></textarea>
                          </div>
                        </div>
                        <div class="col-md-12" id = "buttonGroup">
                          <button class = "btn btn-primary" type = "button" onclick = "reload()">Cancel</button>
                          <button class = "btn btn-primary" type = "submit">Submit Ticket</button>
                        </div>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <!-- /.8 -->
          </div>
<script>
let firstName = document.getElementById("form_name")
let lastName = document.getElementById("form_lastname")
let textArea = document.getElementById("form_message")
let email = document.getElementById("form_email")
let assignedTO = document.getElementById("form_assigned")
let selection = document.getElementById("form_need")
let priority = document.getElementById("form_priority")
let status = document.getElementById("form_status")

id = sessionStorage.getItem('id');
// Getting Ticket details to view on the page
url = `/tickets/${id}`;
fetch(url).then(res => {
    return res.json();
})
.then(result =>{
    console.log(result)
    let firstLastName = result.name.split(" ")
    console.log(firstLastName);
    firstName.value = firstLastName[0];
    lastName.value = firstLastName[1];
    textArea.value = result.ticketDetails;
    email.value = "No email attached"|| result.email;
    assignedTO.value = result.type|| "";
    status.value = status.type|| "";
    priority.value = priority.type|| "";
    selection.value = result.type || "";


})

// to tuggle btw disable and unable to limit error
function disableEnable(element){
    if(element.disabled)
        element.disabled = false;
    else
        element.disabled = true;
}

function reload() {
    window.location = "http://localhost:3030/dashboard.html";
}
function submitUpdate(){
  data = {
    name: `${firstName.value} ${lastName.value}`,
    email: email.value,
    type: selection.value,
    assignedTO: assignedTO.value,
    status: status.value,
    priority: priority.value,
    ticketDetails: textArea.value
  }
  console.log(data)
  id = sessionStorage.getItem('id');
  url = `/tickets/${id}`
  fetch(url,{
    method:"put",
    body:JSON.stringify(data)
  }).then(res => res.json)
  .then(result => console.log(result))
}


</script>
</body>
</html>